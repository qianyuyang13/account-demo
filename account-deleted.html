<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå‰Šé™¤ã•ã‚Œã¦ã„ã¾ã™</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1726;
      --muted:#9aa4b2;
      --accent:#5dd0c6;
      --danger:#e14b4b;
      font-family: "Noto Sans JP", "Hiragino Kaku Gothic ProN", system-ui, -apple-system, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg,#061021,#0b1220);
      color:#e6eef6;
      padding:20px;
    }
    .panel{
      width:100%;
      max-width:920px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:28px;
      display:grid;
      grid-template-columns:1fr 360px;
      gap:22px;
      box-shadow:0 10px 50px rgba(2,6,23,0.6);
      align-items:start;
    }
    .main h1{margin:0 0 8px 0;font-size:22px}
    .main p{margin:0;color:var(--muted);font-size:14px}
    .status{
      margin-top:18px;
      padding:18px;border-radius:10px;
      background:linear-gradient(90deg, rgba(225,75,75,0.06), rgba(225,75,75,0.02));
      border:1px solid rgba(225,75,75,0.12);
    }
    .status strong{display:block;font-size:16px;margin-bottom:6px}
    .muted{color:var(--muted)}
    .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    button{
      padding:10px 14px;border-radius:10px;border:0;font-weight:600;font-size:14px;cursor:pointer;
    }
    .btn-primary{background:var(--accent);color:#032226}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn-danger{background:var(--danger);color:white}
    .side{
      padding:18px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(255,255,255,0.02);
      font-size:14px;
    }
    .side h3{margin:0 0 8px 0}
    .note{font-size:13px;color:var(--muted);margin-top:10px}
    .hint{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;margin-top:12px;color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .linklike{color:var(--accent);cursor:pointer;text-decoration:underline}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#071026;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 6px 20px rgba(0,0,0,0.6);display:none}
    @media (max-width:880px){
      .panel{grid-template-columns:1fr;padding:18px}
      .side{order:2}
    }
  </style>
</head>
<body>
  <main class="panel" role="main" aria-labelledby="title">
    <section class="main" aria-label="ãƒ¡ã‚¤ãƒ³">
      <h1 id="title">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å‰Šé™¤ã•ã‚Œã¦ã„ã¾ã™ ğŸ—‘ï¸</h1>
      <p class="muted">å…¥åŠ›ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆã¾ãŸã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰ã¯æ—¢ã«å‰Šé™¤ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®é¸æŠè‚¢ã‹ã‚‰æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>

      <div class="status" role="status" aria-live="polite">
        <strong>å‰Šé™¤ã®çŠ¶æ…‹:</strong>
        <div id="deletionStateText" class="small">ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ <strong>å®Œå…¨ã«å‰Šé™¤æ¸ˆã¿</strong> ã§ã™ï¼ˆå¾©æ—§ä¸å¯ï¼‰ã€‚</div>
        <div id="graceInfo" class="small muted" style="margin-top:8px;display:none">
          â€» ä¸€éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯å‰Šé™¤ã‹ã‚‰ä¸€å®šæœŸé–“ï¼ˆä¾‹: 14æ—¥ï¼‰ã®çŒ¶äºˆæœŸé–“ãŒã‚ã‚Šã€ãã®é–“ã¯å¾©æ—§ã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
        </div>
      </div>

      <div style="margin-top:16px">
        <label for="emailInput" class="small">è©¦ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input id="emailInput" type="text" placeholder="you@example.com" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
        <div id="emailError" class="small" style="color:#ffb4b4;display:none;margin-top:8px"></div>
      </div>

      <div class="actions" id="primaryActions" style="margin-top:12px">
        <!-- ãƒœã‚¿ãƒ³ã¯JSã§å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆ -->
      </div>

      <div class="note" id="explainBlock" style="margin-top:16px">
        <strong>ä½•ãŒèµ·ããŸã®ï¼Ÿ</strong>
        <div class="muted" style="margin-top:8px">
          ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ã¯é€šå¸¸ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»æŠ•ç¨¿ãƒ»å€‹äººãƒ‡ãƒ¼ã‚¿ç­‰ã‚’ã‚µãƒ¼ãƒ“ã‚¹å´ã§å‰Šé™¤ã™ã‚‹æ“ä½œã§ã™ã€‚å‰Šé™¤ãŒã€Œå®Œå…¨å‰Šé™¤ã€ã®å ´åˆã€åŒã˜ãƒ¡ãƒ¼ãƒ«ã§å†ç™»éŒ²ã—ã¦ã‚‚ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ã¯å¾©å…ƒã§ãã¾ã›ã‚“ã€‚<br>
          å¾©æ—§ãŒå¯èƒ½ãªã€ŒçŒ¶äºˆæœŸé–“ã€ãŒã‚ã‚‹å ´åˆã¯ã€ãã®æ‰‹é †ã‚’æ¡ˆå†…ã—ã¾ã™ã€‚
        </div>
      </div>

      <div class="hint" id="helpHint">
        <strong>ã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ï¼Ÿ</strong>
        <div style="margin-top:8px" class="muted">
          å¾©æ—§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„èª¤å‰Šé™¤ã®ç¢ºèªã¯ã‚µãƒãƒ¼ãƒˆçµŒç”±ã§æ‰¿ã‚Šã¾ã™ã€‚æœ¬äººç¢ºèªãŒå¿…è¦ã§ã™ã€‚ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®é€£çµ¡å…ˆã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚
          <div style="margin-top:8px">
            <span class="small">ãƒ¡ãƒ¼ãƒ«: </span><a id="supportMail" href="mailto:support@example.com?subject=ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ã«ã¤ã„ã¦" class="linklike">support@example.com</a>
            <span style="margin-left:12px" class="small">ã¾ãŸã¯</span>
            <a id="supportUrl" href="#" class="linklike" style="margin-left:6px">ã‚µãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸</a>
          </div>
        </div>
      </div>
    </section>

    <aside class="side" aria-label="è£œåŠ©æƒ…å ±">
      <h3>æ¬¡ã«ã§ãã‚‹ã“ã¨</h3>
      <ul style="color:var(--muted);margin-top:8px;padding-left:18px">
        <li>çŒ¶äºˆæœŸé–“å†…ãªã‚‰å¾©æ—§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ï¼ˆå¾©æ—§ã§ãã‚‹å ´åˆãŒã‚ã‚‹ï¼‰</li>
        <li>å®Œå…¨å‰Šé™¤ãªã‚‰æ–°è¦ç™»éŒ²ï¼ˆåŒã˜ãƒ¡ãƒ¼ãƒ«ã§ç™»éŒ²å¯ã ãŒãƒ‡ãƒ¼ã‚¿ã¯æˆ»ã‚‰ãªã„ï¼‰</li>
        <li>ä¸å¯©ãªå‰Šé™¤ã®ç–‘ã„ãŒã‚ã‚Œã°ã‚µãƒãƒ¼ãƒˆã¸é€£çµ¡</li>
      </ul>

      <div style="margin-top:12px">
        <h3>é‹ç”¨ãƒ¡ãƒ¢ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰</h3>
        <div class="small muted">
          - ã‚µãƒ¼ãƒãƒ¼ã¯å‰Šé™¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆsoft_deleted, scheduled, permanently_deletedï¼‰ã‚’è¿”ã™APIã‚’ç”¨æ„ã™ã‚‹ã€‚<br>
          - çŒ¶äºˆæœŸé–“(flow)ãŒã‚ã‚‹å ´åˆã¯ recovery_token ã‚’ç™ºè¡Œã—å®‰å…¨ã«å¾©æ—§å‡¦ç†ã‚’è¡Œã†ã€‚<br>
          - ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œæ™‚ã¯ã“ã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸ã°ã›ã‚‹ã€‚
        </div>
      </div>
    </aside>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // --- ã‚µãƒ³ãƒ—ãƒ«ã®å‹•ä½œãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Ÿé‹ç”¨ã§ã¯ã‚µãƒ¼ãƒAPIã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰ ---
    // æ“¬ä¼¼ãƒ‡ãƒ¼ã‚¿: ã‚µãƒ¼ãƒã‹ã‚‰å—ã‘å–ã£ãŸå‰Šé™¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ä¾‹
    // possible values: "permanently_deleted", "soft_deleted", "scheduled_deletion"
    // â€» æœ¬ç•ªã§ã¯ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œæ™‚ã«ã‚µãƒ¼ãƒãŒã“ã®ãƒšãƒ¼ã‚¸ã‚’è¿”ã—ã€status ã‚’åŸ‹ã‚è¾¼ã‚€ã‹ API ã§å–å¾—ã™ã‚‹
    let serverStatus = "permanently_deleted"; // â† æœ¬ç•ªã§ã¯ã‚µãƒ¼ãƒå´ã§æ±ºå®šã—ã¦åŸ‹ã‚è¾¼ã‚€
    // ã‚‚ã—çŒ¶äºˆæœŸé–“ãŒã‚ã‚‹ãªã‚‰æ¬¡ã®ã‚ˆã†ã«è¨­å®š
    // serverStatus = "soft_deleted"; // (å¾©æ—§å¯èƒ½)
    // serverStatus = "scheduled_deletion"; // (å‰Šé™¤äºˆå®šã€‚çŒ¶äºˆæœŸé–“ä¸­)

    const emailInput = document.getElementById('emailInput');
    const primaryActions = document.getElementById('primaryActions');
    const deletionStateText = document.getElementById('deletionStateText');
    const graceInfo = document.getElementById('graceInfo');
    const toast = document.getElementById('toast');
    const emailError = document.getElementById('emailError');
    const supportUrl = document.getElementById('supportUrl');
    const supportMail = document.getElementById('supportMail');

    // ã‚µãƒãƒ¼ãƒˆURLã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€
    supportUrl.href = "/support"; // â† å®Ÿé‹ç”¨ã®ã‚µãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã«ç½®æ›

    function showToast(msg, timeout=3000){
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(()=> toast.style.display='none', timeout);
    }

    function renderForStatus(){
      primaryActions.innerHTML = '';
      emailError.style.display = 'none';

      if (serverStatus === 'permanently_deleted'){
        deletionStateText.innerHTML = 'ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ <strong>å®Œå…¨ã«å‰Šé™¤æ¸ˆã¿ï¼ˆpermanently deletedï¼‰</strong> ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã¯ã§ãã¾ã›ã‚“ã€‚';
        graceInfo.style.display = 'none';

        // ãƒœã‚¿ãƒ³: æ–°è¦ç™»éŒ²ã€ã‚µãƒãƒ¼ãƒˆã€æˆ»ã‚‹
        const signup = createButton('æ–°è¦ç™»éŒ²ã™ã‚‹', 'btn-primary', ()=>{
          // ã“ã“ã¯ /signup ãªã©ã¸é·ç§»
          location.href = '/signup';
        });
        const contact = createButton('ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡ã™ã‚‹', 'btn-ghost', ()=>{
          location.href = supportMail.href;
        });
        const back = createButton('ã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹', 'btn-ghost', ()=>{
          location.href = '/login';
        });
        primaryActions.appendChild(signup);
        primaryActions.appendChild(contact);
        primaryActions.appendChild(back);

      } else if (serverStatus === 'soft_deleted' || serverStatus === 'scheduled_deletion'){
        // å¾©æ—§å¯èƒ½ãªä¾‹: è¡¨ç¤ºã‚’å¤‰ãˆã‚‹
        deletionStateText.innerHTML = serverStatus === 'soft_deleted'
          ? 'ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ä¸€æ™‚çš„ã«å‰Šé™¤ï¼ˆã¾ãŸã¯ç„¡åŠ¹åŒ–ï¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚å¾©æ—§ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚'
          : 'ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å‰Šé™¤äºˆå®šã§ã™ã€‚çŒ¶äºˆæœŸé–“ä¸­ã¯å¾©æ—§ã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚';

        graceInfo.style.display = 'block';

        const recover = createButton('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å¾©æ—§ã™ã‚‹', 'btn-primary', async ()=>{
          const email = emailInput.value.trim();
          if (!validateEmail(email)){
            emailError.textContent = 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
            emailError.style.display = 'block';
            return;
          }
          // å®Ÿéš›ã¯ã“ã“ã§ã‚µãƒ¼ãƒã¸å¾©æ—§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹
          // fetch('/api/recover-account', {method:'POST', headers:{'content-type':'application/json'}, body:JSON.stringify({email})})
          //  .then(...)
          showToast('å¾©æ—§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ã‚µãƒãƒ¼ãƒˆã‹ã‚‰ã®æŒ‡ç¤ºã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚');
        });

        const contact = createButton('ã‚µãƒãƒ¼ãƒˆã«å•ã„åˆã‚ã›', 'btn-ghost', ()=>{
          location.href = supportMail.href;
        });

        const signup = createButton('æ–°è¦ç™»éŒ²ï¼ˆåˆ¥ã®ãƒ¡ãƒ¼ãƒ«ï¼‰', 'btn-ghost', ()=>{
          location.href = '/signup';
        });

        primaryActions.appendChild(recover);
        primaryActions.appendChild(contact);
        primaryActions.appendChild(signup);
      } else {
        // ä¸æ˜ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        deletionStateText.innerHTML = 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®çŠ¶æ…‹ã‚’ç¢ºèªã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚';
        graceInfo.style.display = 'none';
        const contact = createButton('ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡ã™ã‚‹', 'btn-primary', ()=>{ location.href = supportMail.href; });
        primaryActions.appendChild(contact);
      }
    }

    function createButton(text, cls, onClick){
      const b = document.createElement('button');
      b.type = 'button';
      b.className = cls;
      b.textContent = text;
      b.addEventListener('click', onClick);
      return b;
    }

    function validateEmail(e){
      // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒã‚§ãƒƒã‚¯ã€‚ã‚µãƒ¼ãƒãƒ¼å´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¿…é ˆã€‚
      if (!e || e.length < 6) return false;
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(e);
    }

    // åˆæœŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    renderForStatus();

    // é–‹ç™ºè€…å‘ã‘: çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ï¼ˆã“ã®ã‚³ãƒ¼ãƒ‰ã¯æœ¬ç•ªä¸è¦ï¼‰
    // console.log('ç¾åœ¨ã® serverStatus:', serverStatus);
    // ä»¥ä¸‹ã¯ãƒ‡ãƒãƒƒã‚°ç”¨ï¼ˆä»»æ„ï¼‰
    // setTimeout(()=>{ serverStatus = 'soft_deleted'; renderForStatus(); }, 1000);

  </script>
</body>
</html>
